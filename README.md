# **Finance Manager**

Консольное backend-приложение для управления личными финансами с поддержкой нескольких пользователей, бюджетов по категориям, переводов между пользователями, статистики и сохранения данных между сессиями.

Проект реализован в формате **CLI-приложения** и разработан в рамках учебного задания по backend-разработке с акцентом на архитектуру, бизнес-логику, валидацию данных и тестирование.

---

## **Описание**

Приложение позволяет пользователям:

- регистрироваться и входить в систему по логину и паролю;
- добавлять доходы и расходы с привязкой к категориям;
- устанавливать бюджеты на категории расходов;
- получать предупреждения при достижении порогов бюджета;
- переводить средства между пользователями;
- просматривать детальную статистику по финансам;
- сохранять данные между сессиями;
- экспортировать статистику в файл (JSON / CSV).

Все данные в течение работы хранятся **в памяти**, а при выходе из приложения сохраняются в файлы.

---

## **Требования**

- **Java 17** или выше
- **Maven 3.8+**

---

## **Получение проекта**

Клонируйте репозиторий и перейдите в каталог проекта:
```
git clone <repository-url>  
cd finance-manager
```
---

## **Сборка проекта**

Проект использует **Maven**, все зависимости загружаются автоматически:
```
mvn clean package
```
---

## **Запуск приложения**

### **Запуск из IDE**

Точка входа в приложение:
```
src/main/java/ru/edu/finance/Main.java
```
Запустите класс **Main**.

---

### **Запуск из JAR**
```
mvn package  
java -jar target/finance-manager-1.0.0.jar
```
---

## **Конфигурация**

Параметры приложения задаются в файле:
```
src/main/resources/config.properties
```
Пример конфигурации:
```
# Budget settings
budget.warning.threshold = 0.80   # порог предупреждения бюджета (80%)

# Storage
storage.data.dir = data           # каталог хранения данных
```
Параметры конфигурации используются как в основном коде приложения, так и в тестах.

---

## **Использование (CLI)**

После запуска приложения доступен интерактивный CLI-интерфейс.

---

### **Аутентификация**

Регистрация нового пользователя:  
```
register <login> <password>
```
Вход в систему:  
```
login <login> <password>
```
Выход из текущей сессии:  
```
logout
```
Просмотр зарегистрированных пользователей (отладка):  
```
users
```
---

### **Финансы**

Добавление дохода: 
```
income <category> <amount>
```
Добавление расхода: 
```
expense <category> <amount>
```
Перевод средств другому пользователю:  
```
transfer <login> <amount>
```
---

### **Бюджеты**

Установка бюджета для категории:  
```
set-budget <category> <limit>
```
Просмотр всех бюджетов текущего пользователя:  
```
budgets
```
При достижении порога бюджета (например, 80%) пользователь получает предупреждение.

---

### **Статистика**

Общая статистика:  
```
stats
```
Статистика по одной категории:  
```
stats category <name>
```
Статистика по нескольким категориям:  
```
stats categories <cat1,cat2,cat3>
```
Выводятся:
- общий доход;
- общий расход;
- расходы по категориям;
- текущий статус бюджетов.

---

### **Экспорт статистики**

Экспорт статистики в файл:
```
export stats            #Экспорт статистики (JSON)
export stats json       #Экспорт статистики в JSON
export stats csv        #Экспорт статистики в CVS
```
Файлы сохраняются в директорию, указанную в конфигурации.

---

### **Завершение работы**
```
exit
```
При выходе:
- автоматически выполняется сохранение данных пользователя;
- кошелёк и операции сохраняются в файл.

---

## **Хранение данных**

Для каждого пользователя создаётся отдельный файл:
```
data/user_<login>.json
```
В файле хранится:
- логин пользователя;
- пароль;
- кошелёк;
- список транзакций;
- бюджеты по категориям.

Загрузка данных происходит при авторизации пользователя.

---

## **Валидация данных**

В приложении реализована строгая валидация:

- сумма должна быть положительной;
- допускается не более двух знаков после запятой;
- категории не могут быть пустыми;
- операции невозможны без авторизации;
- перевод невозможен несуществующему пользователю;
- превышение бюджета отслеживается и уведомляется.

Ошибки выводятся в CLI в понятной форме.

---

## **Архитектура проекта**

Проект реализован с разделением на логические слои и соблюдением принципов чистой архитектуры.

### **Структура проекта**
```
src/main/java/ru/edu/finance  
├── cli          — консольный интерфейс пользователя  
├── model        — доменные модели
├── service      — бизнес-логика приложения  
├── storage      — файловое хранилище данных  
├── config       — загрузка конфигурации  
└── Main.java    — точка входа в приложение
```
---

## **Описание слоёв и компонентов**

### **Model Layer (model)**

Содержит доменные модели, не зависящие от инфраструктуры и пользовательского интерфейса.

- **User** — модель пользователя с логином, паролем и привязанным кошельком.
- **Wallet** — кошелёк пользователя, содержащий транзакции и бюджеты.
- **Transaction** — финансовая операция (доход, расход, перевод) с категорией, суммой и временем.
- **TransactionType** — перечисление типов транзакций.
- **Budget** — бюджет для категории расходов с установленным лимитом.

---

### **Service Layer (service)**

Содержит основную бизнес-логику приложения.

- **UserService** — регистрация, авторизация и управление пользовательской сессией.
- **FinanceService** — добавление доходов и расходов, валидация сумм, контроль бюджетов.
- **StatisticsService** — подсчёт доходов и расходов, агрегация данных по категориям.
- **TransferService** — переводы средств между пользователями.
- **ReportService** — генерация и экспорт статистических отчётов (JSON / CSV).

---

### **Storage Layer (storage)**

Отвечает за сохранение и загрузку данных между сессиями.

- **FileStorage** — файловая реализация хранилища пользователей и их кошельков с использованием JSON.

---

### **CLI Layer (cli)**

Отвечает за взаимодействие с пользователем через консоль.

- **CommandRouter** — обработка и маршрутизация CLI-команд, вывод сообщений пользователю.

CLI не содержит бизнес-логики и работает через сервисный слой.

---

### **Config Layer (config)**

Отвечает за конфигурацию приложения.

- **ConfigLoader** — загрузка параметров из файла `config.properties` и предоставление их всему приложению, включая тесты.

---

### **Util Layer (util)**

Содержит вспомогательные компоненты.

- **Validator** — валидация пользовательского ввода и проверка корректности данных.

---

Такое разделение обеспечивает читаемость кода, удобство тестирования и возможность дальнейшего расширения приложения без изменения существующей архитектуры.

---

## **Принципы проектирования**

В проекте применяются следующие принципы:

- Separation of Concerns
- Single Responsibility Principle
- Разделение CLI и бизнес-логики
- Единый источник конфигурации
- Тестируемость бизнес-логики

---

## **Тестирование**

Проект покрыт **unit- и интеграционными тестами** с использованием **JUnit 5**.

### **Запуск тестов**
```
mvn test
```
---

### **Покрываемые сценарии**

**UserServiceTest**
- регистрация пользователей;
- защита от дубликатов;
- корректная авторизация;
- проверка паролей.

**FinanceServiceTest**
- добавление доходов и расходов;
- валидация сумм;
- проверка граничных значений.

**StatisticsServiceTest**
- подсчёт общих доходов и расходов;
- агрегация по категориям;
- выборки по нескольким категориям;
- корректная обработка отсутствующих данных.

**TransferServiceTest**
- перевод средств между пользователями;
- корректное создание транзакций;
- изоляция тестов с очисткой файлового хранилища;
- использование пути хранения из конфигурации.

---

